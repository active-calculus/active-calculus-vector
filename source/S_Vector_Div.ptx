<section xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="S_Vector_Div">
  <title>The Divergence of a Vector Field</title>
<objectives>
  <ul>
    <li>
      <p>How can you measure where a vector field's strength is increasing or decreasing?
      </p>
    </li>
    <li>
      <p>
       What does the divergence of a vector field measure and how can you visually estimate whether the divergence of a vector field is positive or negative?
      </p>
    </li>
  </ul>
</objectives>
<introduction>
  <p>
    As we saw in <xref ref="S_Vector_VectorFields"/>, there are many physical and theoretical representations for vector fields. A natural question is <q>Where exactly is the vector field created?</q> With the vector field in <xref ref="fig_Vector_Div_vf1"/>, imagine sketching a curve that follows the direction of the vector field by treating the vectors in the vector field as tangent vectors to your curve. No matter where you start, you should observe that the vector field decreases in strength as you move along the flow. We wish to understand (as a function of position), how much of the vector field is created (or destroyed) at a given location.
  </p>
  <figure xml:id="fig_Vector_Div_vf1">
    <caption>A vector field with changing strength</caption>
    <image width="55%" xml:id="img_Vector_Div_vf1">
      <description>
        A vector field with vectors shortest along the line <m>y=x</m> and longer as distance from that line increases. Vectors in the fourth quadrant point primarily in the positive <m>x</m>-direction, although none are truly vertical. Vectors in the second quadrant point primarily in the negative <m>x</m>-direction, although none are truly vertical. Vectors in the first and third quadrants exhibit a form of counterclockwise rotation.
      </description>
      <sageplot>
        var('x,y,t')
        final_plot2=plot_vector_field((sin(x+y),(x-y)),(x,-3.1,3.1),(y,-3.1,3.1),headwidth=4,plot_points=15,zorder=-1,color='blue',axes_labels=["$x$","$y$"],frame=False,aspect_ratio=1,ticks=[[],[]])
        final_plot2        
      </sageplot>
    </image>
  </figure>
  <exploration xml:id="PA_Vector_Div">
    <introduction>
      <p>
        In this preview activity, we will look at several two-dimensional vector fields and try to assess when the vector field has increased or decreased in strength over a given region. We begin with graphs of the three vector fields, <m>\vF</m>, <m>\vG</m>, and <m>\vH</m>. Parts <xref ref="task_PA_Vector_Div_InOut" text="local"/>, <xref ref="task_PA_Vector_Div_CreateDestroy" text="local"/>, and <xref ref="task_PA_Vector_Div_Smaller" text="local"/> ask you to answer the same three questions about the vector field and square illustrated in each of the figures. <xref ref="task_PA_Vector_Div_P4P5P6" text="local">Part</xref> asks you to think further about the third vector field.
      </p>
      <figure xml:id="fig_Vector_Div_PA_vf1">
        <caption>Vector Field <m>\vF</m></caption>
        <image width="55%" xml:id="img_PA_div_xy_field">
          <description>A vector field with vectors radiating from the origin. The length of vectors increases as distance from the origin increases. There is a square in the first  quadrant with sides parallel to the coordinate axes. Centered in the square is a point labeled <m>P_1</m>, which appears to lie on the line <m>y=x</m>.</description>
          <sageplot>
            var('t,x,y')
            plot1=plot_vector_field((x,y),(x,-2,2),(y,-2,2),color='blue',axes_labels=["$x$","$y$"],frame=False,aspect_ratio=1,ticks=[[],[]])
            plot1+=text("$P_1$",(1.25,1.25),color='black',fontsize=12,background_color='white')
            plot1+=line([(.5,1.5),(1.5,1.5),(1.5,.5),(.5,.5),(.5,1.5)],color='black',thickness=2)+point((1,1),size=30,color='black')
            plot1           
          </sageplot>
        </image>
      </figure>
      <figure xml:id="fig_Vector_Div_PA_vf2">
        <caption>Vector Field <m>\vG</m></caption>
        <image width="55%" xml:id="img_PA_div_xy_field2">
          <description>A vector field with vectors below the <m>x</m>-axis pointing primarily up near the axis and primarily to the right farther away from the axis. Above the <m>x</m>-axis, vectors point primarily to the right. Vector magnitudes are shortest near the positive <m>y</m>-axis. There is a square in the second quadrant with sides parallel to the coordinate axes. Centered in the square is a point labeled <m>P_2</m>, which appears to lie on the line <m>y=-x</m>.</description>
          <sageplot>
            var('t,x,y')
            plot1=plot_vector_field((x^2,1-y),(x,-2,2),(y,-2,2),color='blue',axes_labels=["$x$","$y$"],frame=False,aspect_ratio=1,ticks=[[],[]])
            plot1+=point((-1,1),size=30,color='black')+text("$P_2$",(-0.75,0.75),color='black',fontsize=12,clip=True,background_color='white')
            plot1+=line([(-.5,1.5),(-1.5,1.5),(-1.5,.5),(-.5,.5),(-.5,1.5)],color='black',thickness=2)
            plot1            
          </sageplot>
        </image>
      </figure>
      <figure xml:id="fig_Vector_Div_PA_vf3">
        <caption>Vector Field <m>\vH</m></caption>
        <image width="55%" xml:id="img_PA_div_-yx_field">
          <description> A vector field in which vectors circulate around the origin as if tangent vectors to concentric circles centered at the origin. Vector magnitude increases as distance from the origin increases. There is a square in the first quadrant with sides parallel to the coordinate axes. Centered in the square is a point labeled <m>P_3</m>. There is a point labeled <m>P_4</m> in the second quadrant that is the reflection of <m>P_3</m> across the <m>y</m>-axis. In the third quadrant, there is a point <m>P_5</m> that is closer to the <m>y</m>-axis than to the <m>x</m>-axis. In the fourth quadrant, there is a point labeled <m>P_6</m> that appears to be on the line <m>y=-x</m> but is farther from the origin than <m>P_3</m> or <m>P_4</m>.</description>
          <sageplot>
            var('t,x,y')
            plot2=plot_vector_field((-y,x),(x,-2,2),(y,-2,2),color='blue',axes_labels=["$x$","$y$"],frame=False,aspect_ratio=1,ticks=[[],[]])
            plot2+=point((1,1),size=20,color='black')+text("$P_3$",(1.25,1.25), color='black',fontsize=12,clip=True,background_color='white')
            plot2+=point((-1,1),size=20,color='black')+text("$P_4$",(-0.75,0.75), color='black',fontsize=12,clip=True,background_color='white')
            plot2+=point((-.5,-1),size=20,color='black')+text("$P_5$",(-.4,-.75), color='black',fontsize=12,clip=True,background_color='white')
            plot2+=point((1.5,-1.5),size=20,color='black')+text("$P_6$",(1.75,-1.75), color='black',fontsize=12,clip=True,background_color='white')
            plot2+=line([(.5,1.5),(1.5,1.5),(1.5,.5),(.5,.5),(.5,1.5)],color='black',thickness=2)
            plot2            
          </sageplot>
        </image>
      </figure>
    </introduction>
    <task xml:id="task_PA_Vector_Div_InOut">
      <statement>
        <p>
          For each of the vector fields <m>\vF</m>, <m>\vG</m>, and <m>\vH</m> and the square centered on <m>P_1</m>, <m>P_2</m>, and <m>P_3</m> (respectively), which statement do you think best applies?
          <ol marker="i">
            <li><p>More of the vector field is going into the square than going out. </p></li>
            <li><p>Less of the vector field is going into the square than going out. </p></li>
            <li><p>The same amount of the vector field is going into the square as is going out. </p></li>
          </ol>
        </p>
      </statement>
    </task>
    <task xml:id="task_PA_Vector_Div_CreateDestroy">
      <statement>
        <p>
          For each of the vector fields <m>\vF</m>, <m>\vG</m>, and <m>\vH</m> (and corresponding square), does your answer to <xref ref="task_PA_Vector_Div_InOut" text="local">part</xref> suggest that the vector field is being created, destroyed, or is unchanging in strength inside the square? Write a sentence to explain your thinking for each vector field.
        </p>
      </statement>
    </task>
    <task xml:id="task_PA_Vector_Div_Smaller">
      <statement>
        <p>
          Would the answer to parts <xref ref="task_PA_Vector_Div_InOut" text="local"/> or <xref ref="task_PA_Vector_Div_CreateDestroy" text="local"/> change if you used a smaller square centered on <m>P_1</m>, <m>P_2</m>, and <m>P_3</m> for the corresponding vector fields? Write a sentence to explain your thinking for each vector field.
        </p>
      </statement>
    </task>
    <task xml:id="task_PA_Vector_Div_P4P5P6">
      <statement>
        <p>
          Thinking now only about the vector field <m>\vH</m>, would your answers to parts <xref ref="task_PA_Vector_Div_InOut" text="local"/>, <xref ref="task_PA_Vector_Div_CreateDestroy" text="local"/>, or <xref ref="task_PA_Vector_Div_Smaller" text="local"/> change if you considered squares around points <m>P_4</m>, <m>P_5</m>, or <m>P_6</m>? Write a couple of sentences to explain your thinking.
        </p>
      </statement>
    </task>
  </exploration>
</introduction>


<subsection xml:id="SS_Vector_Div_Defn">
  <title>Definition of the Divergence of a Vector Field</title>
  <p>
    We begin this subsection by stating a definition that captures analytically the ideas you reasoned aboug geometrically in <xref ref="PA_Vector_Div" />. After the statement of the definition, we discuss what it means.
  </p>
  <definition xml:id="defn_Div">
  <statement>
    <p>
      The <term>divergence of a vector field</term>
      <me>\vF(x,y)=\langle F_1(x,y),F_2(x,y), F_3(x,y)\rangle</me>
      is given by
      <me>
        \divg(\vF)=\frac{\partial F_1}{\partial x}+\frac{\partial F_2}{\partial y} + \frac{\partial F_3}{\partial z}
      </me>.
      In two dimensions, the definition is analogous by omiting the third term.
    </p>
  </statement>
</definition>
<aside>
  <title>Alternative Notation for Divergence</title>
  <p>
    In other sources you may see the divergence written using a dot product as <m>\divg(\vF) = \nabla\cdot \vF</m>.
    <!--<md>
    <mrow>
    	\divg(\vF) \amp = \nabla \cdot \vF = 
    	\langle \frac{\partial}{\partial x},\frac{\partial}{\partial y},\frac{\partial}{\partial z}\rangle \cdot \langle F_1,F_2,F_3 \rangle 
    	</mrow>
    	<mrow> \amp= 
    	    	\frac{\partial}{\partial
    		x}(F_1)+\frac{\partial}{\partial
    		y}(F_2)+\frac{\partial}{\partial z}(F_3) =
    		\frac{\partial F_1}{\partial x}+\frac{\partial
    		F_2}{\partial y}+\frac{\partial F_3}{\partial z}
    	</mrow>
    </md>.-->
    This notation is very compact and works well with the understanding that the del operator <m>\nabla = \langle
    \frac{\partial}{\partial x},\frac{\partial}{\partial y},\frac{\partial}{\partial z}\rangle</m> is a function that operates on other functions. However, this notation can also be confusing because of its emphasis on computation rather than conceptual understanding. In this text, we will not generally write the divergence using the del operator.
  </p>
</aside>
<p>
  The divergence of a vector field is a scalar measurement at a point that measures how the strength of the vector field is changing as we look small neighborhoods around our point. While <xref ref="SS_Vector_Div_Development"/> will show the details for how the divergence is defined, we can make the following qualitative argument: If we are looking at how the strength of the vector field is changing in a small neighborhood of the point <m>(a,b)</m>, then we only need to look how fast the horizontal component is changing horizontally and how the vertical component is changing vertically. We make this measurement of changing strength of the vector field by measuring how much of a vector field flows into versus out of a small neighborhood of our point (as was done in <xref ref="PA_Vector_Div" />). When looking at a small neighborhood of the point (as shown by the square in <xref ref="fig_S_Vector_Div_box" />), only the change of the horizontal component of the vector field contributes to flow in or out on the sides and only the change in the vertical component contributes to flow in or our on the top and bottom.
</p>

<example>
  <p>
    Let <m>\vF=\langle x, y \rangle</m>. Then <me>\divg(\vF)= \dfrac{\partial}{\partial x} (x)+ \dfrac{\partial}{\partial y} (y) = 1+1=2</me>. From our conceptual description above, <m>\divg(\vF)</m> being positive means that our vector field is increasing in strength. Since the divergence of <m>\vF</m> does not have a dependence on the input point, that means the vector field is increasing in strength, regardless of which point we consider. In the interactive element below, you can change the point you would like plotted and the size of the region around the point. You should see that regardless of what point you select or how small you make the region around the point, there will be more of the vector field flowing out of the region than in.
  </p>
  <figure xml:id="fig_div_ex1">
    <caption>An interactive plot of <m>\vF=\langle x,y\rangle</m> with point <m>(a,b)</m> and region plotted</caption>
    <interactive xml:id="sage_div_interact1" platform="sage" width="98%" aspect="1:1.20">
      <slate surface="sage">
        var('t,x,y')
        F=(x,y)
        @interact
        def _(a=input_box(default=1,label="x-coordinate",width=30),b=input_box(default=-1,label="y-coordinate",width=30),r=input_box(default=0.5,label="radius of region",width=30)):
          plot1=plot_vector_field(F,(x,a-3*r,a+3*r),(y,b-3*r,b+3*r),color='blue')
          plot1+=point((a,b),color='black',size=30)+parametric_plot((a+r*cos(t),b+r*sin(t)),(t,0,2*pi), color='black',thickness=2)
          show(plot1)
      </slate>
    </interactive>
  </figure>
</example>
<example>
  <p>
    Let <m>\vG=\langle y,-x \rangle</m>. We can compute that <me>\divg(\vG)= \dfrac{\partial}{\partial x} (y)+ \dfrac{\partial}{\partial y} (-x) = 0</me>. From our conceptual description of divergence, <m>\divg(\vG)</m> being zero means that our vector field is not changing in strength. Since the divergence of <m>\vG</m> does not have a dependence on the input point, that means the vector field is not changing in strength, regardless of which point we consider.
    </p>
    <p>In the interactive element below, you can change the point you would like plotted and the size of the region around the point. You should see that regardless of what point you select or how small you make the region around the point, there will be exactly as much of the vector field flowing into the region as is flowing out (on the other side).
  </p>
  <figure xml:id="fig_div_ex2">
    <caption>An interactive plot of <m>\vG=\langle y,-x \rangle</m> with point <m>(a,b)</m> and region plotted</caption>
    <interactive xml:id="sage_div_interact2" platform="sage" width="98%" aspect="1:1.20">
      <slate surface="sage">
        var('t,x,y')
        F=(y,-x)
        @interact
        def _(a=input_box(default=1,label="x-coordinate",width=30),b=input_box(default=-1,label="y-coordinate",width=30),r=input_box(default=0.5,label="radius of region",width=30)):
          plot1=plot_vector_field(F,(x,a-3*r,a+3*r),(y,b-3*r,b+3*r),color='blue')
          plot1+=point((a,b),color='black',size=30)+parametric_plot((a+r*cos(t),b+r*sin(t)),(t,0,2*pi), color='black',thickness=2)
          show(plot1)
      </slate>
    </interactive>
  </figure>
</example>
<example>
  <p>
    Let <m>\vH=\langle x^2-y,y^2-x \rangle</m>, which means that <me>\divg(\vH)= \dfrac{\partial}{\partial x} (x^2-y)+ \dfrac{\partial}{\partial y} (y^2-x) = 2x+2y</me>. In constrast to the previous examples, you can see that the value of divergence of <m>\vH</m> will depend on the input point choosen. For instance, <m>\divg(\vH)</m> will be <m>4</m> at the point <m>(1,1)</m>. This means that for a small region around <m>(1,1)</m> there should be more of the vector field flowing out of the region than into it. Use the interactive element below to verify this.
  </p>
  <figure xml:id="fig_div_ex3">
    <caption>An interactive plot of <m>\vH=\langle x^2-y,y^2-y\rangle</m> with point <m>(a,b)</m> and region plotted</caption>
    <interactive xml:id="sage_div_interact3" platform="sage" width="98%" aspect="1:1.20">
      <slate surface="sage">
        var('t,x,y')
        F=(x^2-y,y^2-x)
        @interact
        def _(a=input_box(default=1.5,label="x-coordinate",width=30),b=input_box(default=-1.5,label="y-coordinate",width=30),r=input_box(default=0.5,label="radius of region",width=30)):
          plot1=plot_vector_field(F,(x,a-3*r,a+3*r),(y,b-3*r,b+3*r),color='blue')
          plot1+=point((a,b),color='black',size=30)+parametric_plot((a+r*cos(t),b+r*sin(t)),(t,0,2*pi), color='black',thickness=2)
          show(plot1)
      </slate>
    </interactive>
  </figure>
  <p>
    The divergence of <m>\vH</m> at the point <m>(-1,1)</m> will be zero. If you look at this point in <xref ref="fig_div_ex3" />, you will see that there is exactly as much of the vector field flowing into the region around <m>(-1,1)</m> as is flowing out.
  </p>
  <p>
    The divergence of <m>\vH</m> at the point <m>(-2,0)</m> is <m>-4</m>. This should mean that there is more of the vector field flowing into the region around <m>(-2,0)</m> than is flowing out. You should be able to see how difference regions of the <m>xy</m>-plane will have different values for <m>\divg(\vH)</m>.
  </p>
</example>
  <p>
    Another way to <q>see</q> divergence on a vector field plot is to look at what happens to the magnitude of vectors as you move along the flow of the vector field. If the vector field is increasing in magnitude as you move along the flow of a vector field, then the divergence is positive. If the vector field is decreasing in magnitude as you move along the flow of a vector field, then the divergence is negative. If the vector field does
      not change in magnitude as you move along the flow of the vector field, then the divergence is zero. Also, remember that the divergence of a vector field is often a variable quantity and will change depending on location. The next activity asks you to graphically examine the divergence of three vector fields.
  </p>
  <activity xml:id="act_Vector_Div_Graphical">
    <title>Graphical Representations of Divergence</title>
    <task xml:id="task_act_Vector_Div_Graphical_-x-y">
      <introduction>
        <p>
          For this part of the activity, consider the vector field <m>\vF</m> shown in <xref ref="fig_Vector_Div_GraphicalAct_vf1"/>.
        </p>
        <figure xml:id="fig_Vector_Div_GraphicalAct_vf1">
          <caption>Vector field <m>\vF</m></caption>
          <image width="55%" xml:id="img_Div_activity_-x-y">
            <description>A vector field with vectors pointing toward the origin. Vectors get longer as distance from the origin increases. </description>
            <sageplot>
              var('t,x,y')
              plot3=plot_vector_field((-x,-y),(x,-2,2),(y,-2,2),color='blue',axes_labels=["$x$","$y$"],frame=False,aspect_ratio=1,ticks=[[],[]])
              plot3              
            </sageplot>
          </image>
        </figure>
      </introduction>
      <task>
        <statement>
          <p>
            Draw a circle in the first quadrant of the vector field <m>\vF</m> depicted in <xref ref="fig_Vector_Div_GraphicalAct_vf1"/>. Based on the flow of the vector field into or out of the circle, do you think the vector field is increasing in strength, decreasing in strength, or not changing in overall strength in the first quadrant?
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            As you move along the flow of the vector field in the first quadrant of <xref ref="fig_Vector_Div_GraphicalAct_vf1"/>, does your vector field increase in magnitude, decrease in magnitude, or have constant magnitude?
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            Draw a circle in each of quadrants II, II, and IV. Based on the flow of the vector field into or out of your circles, do you think the vector field is increasing in strength, decreasing in strength, or not changing in overall strength in quadrants II, II, and IV?
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            As you move along the flow of the vector field in the third quadrant of <xref ref="fig_Vector_Div_GraphicalAct_vf1"/>, does your vector field increase in magnitude, decrease in magnitude, or have constant magnitude.
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            Based on your arguments above, describe why the divergence of <m>\vF</m> is negative for all points in the <m>xy</m>-plane.
          </p>
        </statement>
      </task>
    </task>
    <task xml:id="task_act_Vector_Div_Graphical_yx">
      <statement>
        <p>
          Look at the plot of the vector field <m>\vG</m> in <xref ref="fig_Vector_Div_GraphicalAct_vf2"/> and state
          whether you think the vector field is increasing in strength, decreasing in strength, or not changing in overall strength in each of the four quadrants. You can make your argument in terms of the change in magnitude along the flow of the vector field or in terms of the net flow into or out of a small region on the plane. You may need to make separate arguments for each of the four quadrants.
        </p>
        <figure xml:id="fig_Vector_Div_GraphicalAct_vf2">
          <caption>Vector field <m>\vG</m></caption>
          <image width="55%" xml:id="img_Div_activity_yx">
            <description>A vector field in which vector magnitudes increase as distance from the origin increases. Vectors are oriented as if they follow hyperbolas with asymptotes <m>y=x</m> and <m>y=-x</m>. Vectors above both asymptotes or below both asymptotes result in counterclockwise rotation. The other vectors result in clockwise rotation.</description>
            <sageplot>
              var('t,x,y')
              plot3=plot_vector_field((y,x),(x,-2,2),(y,-2,2),color='blue',axes_labels=["$x$","$y$"],frame=False,aspect_ratio=1,ticks=[[],[]])
              plot3              
            </sageplot>
          </image>
        </figure>
      </statement>
    </task>
    <task xml:id="task_act_Vector_Div_Graphical_xy1x">
      <statement>
        <p>
          Look at the plot of the vector field <m>\vH</m> in <xref ref="fig_Vector_Div_GraphicalAct_vf3"/> below and state whether you think the vector field is increasing in strength, decreasing in strength, or not changing in overall strength in each of the four quadrants. You can make your argument in terms of the change in magnitude along the flow of the vector field or in terms of the net flow into or out of a small region on the plane. You may need to make separate arguments for each of the four quadrants.
        </p>
        <figure xml:id="fig_Vector_Div_GraphicalAct_vf3">
          <caption>Vector field <m>\vH</m> </caption>
          <image width="55%" xml:id="img_Div_activity_xy1x">
            <description>A vector field having longer vectors where <m>x \lt 0</m>. For <m>x&gt;0</m>, vectors appear to get longer as distance from the <m>x</m>-axis increases. </description>
            <sageplot>
              var('t,x,y')
              plot3=plot_vector_field((x*y,1-x),(x,-2,2),(y,-2,2),color='blue',axes_labels=["$x$","$y$"],frame=False,aspect_ratio=1,ticks=[[],[]])
              plot3              
            </sageplot>
          </image>
        </figure>
      </statement>
    </task>
  </activity>
<p>
  The next activity of this section asks you to do some algebraic calculations of divergence using <xref ref="defn_Div"/>.
</p>
<activity xml:id="act_Vector_Div_Algebraic">
  <task xml:id="task_act_Vector_Div_Algebraic_Calculate">
    <statement>
      <p>Calculate the divergence of the vector fields given below.
      <ul>
        <li> <m>\vF(x,y)=\langle -x,-y\rangle</m></li>
        <li> <m>\vG(x,y)=\langle y,x \rangle</m></li>
        <li> <m>\vH(x,y)=\langle xy,1-x\rangle</m></li>
      </ul>
      </p>
      </statement>
  </task>
  <task xml:id="task_act_Vector_Div_Algebraic_ConnectGraphical">
    <statement>
      <p>
        Explain how your answers to the questions in <xref ref="act_Vector_Div_Graphical"/> can be explained by using your results from <xref ref="task_act_Vector_Div_Algebraic_Calculate" text="local">part</xref> of this activity.
      </p>
    </statement>
  </task>
</activity>
</subsection>
<subsection xml:id="SS_Vector_Div_Development">
  <title> Measuring the Change in Strength of a Vector Field</title>
  <p>
      In this subsection, we examine the details of how to measure the density of the <q>creation</q> or <q>destruction</q> of the vector field in a classic calculus fashion. Specifically, we will measure how the strength of the vector field changes in a region around a point. Next, using a limit, we examine what happens to our measurement as we shrink the region. Because vector fields change in a continuous fashion, the vector fields don't actually change <em>at a single point</em>. Rather, we will measure the density for the change in strength of the vector field.
  </p>
  <p>
      We will develop all of our measurements in a two dimensional setting for now. However, our arguments can be applied to three (or more) dimensions. We start in the same fashion as in <xref ref="PA_Vector_Div"/>. Namely, we will look at how much of the vector field is going into or out of a square centered at a point <m>(a,b)</m>. For this development, we will consider a two-dimensional vector field given by <m>\vF(x,y)=\langle{F_1(x,y),F_2(x,y)}\rangle</m>.
  </p>
  <figure xml:id="fig_S_Vector_Div_box">
    <caption>A square around the point <m>(a,b)</m></caption>
    <image width="55%" xml:id="img_Div_box">
      <description>A square with sides parallel to the coordinate axes and centered at the point <m>(a,b)</m>. The upper-right corner of the square is labeled <m>(a+h,b+h)</m>.</description>
      <sageplot>
        var('x','t');
        d=1
        plot1= point([(2,3)],color='black',size=15)+point([(3,4)],color='purple',size=15)
        plot1+= parametric_plot((2+d*d,3+d*t),(t,-d,d),color='red',axes_labels=["$x$","$y$"],thickness=2,frame=False,aspect_ratio=1,ticks=[[],[]])
        plot1+= parametric_plot((2-d*d,3+d*t),(t,-d,d),color='green',axes_labels=["$x$","$y$"],thickness=2,frame=False,aspect_ratio=1,ticks=[[],[]])
        plot1+= parametric_plot((2+d*t,3+d*d),(t,-d,d),color='blue',axes_labels=["$x$","$y$"],thickness=2,frame=False,aspect_ratio=1,ticks=[[],[]])
        plot1+= parametric_plot((2+d*t,3-d*d),(t,-d,d),color='orange',axes_labels=["$x$","$y$"],thickness=2,frame=False,aspect_ratio=1,ticks=[[],[]])
        plot1+= text("$(a,b)$",(2,3.25),color='black',fontsize='x-large',clip=True,xmin=-.5,xmax=5,ymin=-.5,ymax=5)+text("$(a+h,b+h)$",(3,4.25),color='purple',fontsize='x-large',clip=True,xmin=-.5,xmax=5,ymin=-.5,ymax=5)
        plot1        
      </sageplot>      
    </image>
  </figure>
  <p>
    We can parametrize the top edge of the box by <m>\vr_{\text{top}}(t) = \langle a+t,b+h\rangle</m> with <m> -h\leq t\leq h</m>. Similarly, the bottom, right, and left can be parametrized by
    <md>
      <mrow>\vr_{\text{bottom}}(t) \amp = \langle a+t,b-h\rangle</mrow>
      <mrow>\vr_{\text{right}}(t) \amp = \langle a+h,b+t\rangle</mrow>
      <mrow>\vr_{\text{left}}(t) \amp = \langle a-h,b+t\rangle</mrow>
      </md>
    all of which use parameter values in <m> -h\leq t\leq h</m>.
  </p>
  <p>
    The amount of the vector field <m>\vF</m> that is created inside the square around the point <m>(a,b)</m> can be measured by the net amount of the vector field coming into or going out of the square. The amount of vector flow that goes through each of the boundary segments can be measured by looking at just the orthogonal component of the vector field on each particular segment. For instance, on the top segment, the vertical component <m>F_2</m> determines how much of the vector field goes in or out of the square. Integrating just the vertical component <m>F_2</m> of the vector field <m>\vF</m> over the points on the top segment of our square will therefore measure how much of the vector field goes through the top of the square.
  </p>
  <p>
    The same argument applies to the bottom edge of our square. Similarly, if we want to measure how much of <m>\vF</m> goes through either the left or right side of the square, we need to integrate the horizontal component <m>F_1</m>. Hence, the net flow <m>N</m> of the vector field into or out of the square will be given by
    <md>
      <mrow>N=\int_{-h}^{h} \amp F_2(a+t,b+h) dt - \int_{-h}^{h} F_2(a+t,b-h) dt </mrow>
      <mrow>\amp + \int_{-h}^{h} F_1(a+h,b+t) dt -\int_{-h}^{h} F_1(a-h,b+t) dt</mrow>
    </md>.
    Notice that the integrals corresponding to the left and bottom segments are subtracted because we need to pay attention to the orientation of the vector field relative to the square. A positive vertical component of the vector field (<m>F_2</m>) will correspond to flow out on the top of the square but will correspond to the vector field flowing into the square on the bottom. In the integrals above, we are counting the flow out of the square as positive and the flow in as negative.
  </p>
  <p>
    We are measuring the net flow through the square as a scalar quantity. By decreasing <m>h</m>, we can look at what happens to our amount of flow out of the square as we shrink to the point <m>(a,b)</m>. In order for this to make sense across different size of squares, we will change what we are measuring to be a density argument by calculating flow in (or out) per unit area. This will allow us to compare our net flow calculations across squares with different areas. In other words, we want to consider what happens to
    <md>
      <mrow>\frac{1}{(2h)^2}\amp\left(\int_{-h}^{h} F_2(a+t,b+h) dt - \int_{-h}^{h} F_2(a+t,b-h) dt \right.</mrow>
      <mrow>\amp\left. +\int_{-h}^{h} F_1(a+h,b+t) dt -\int_{-h}^{h} F_1(a-h,b+t) dt \right)</mrow>
    </md>
    as <m>h</m> goes to zero.
  </p>
  <p>
    Before we compute our limit, we will take a moment to simplify our integrals in order to make the limit easier to evaluate. Recall that in single-variable calculus, we defined the <url href="https://activecalculus.org/single/sec-4-3-definite-integral.html#XCM">average value of a function</url> <m>f</m> on an interval <m>[a,b]</m> to be
    <me>
      f_{\text{AVG}[a,b]} = \frac{1}{b-a}\cdot \int_a^b f(t)\, dt
    </me>. It turns out that we can say something stronger: there will be a value <m>t^*</m> in the interval <m>[a,b]</m> so that
    <me>
      f(t^*)(b-a) = \int_a^b f(t)\, dt
    </me>
    when <m>f</m> is continuous on <m>[a,b]</m>. (You can think of the left-hand side as being the area of a rectangle with the interval <m>[a,b]</m> as its base.) We use this fact, sometimes called the Mean Value Theorem for Integrals, to simplify here. Applying the Mean Value Theorem for Integrals to the first integral gives
    <me> 
      \int_{-h}^{h} F_2(a+t,b+h) dt = (2h) \enspace F_2(t^*_1,b+h)
    </me>,
    where <m>t^*_1</m> is some value in the interval <m>(a-h,a+h)</m>. Applying the Mean Value Theorem for Integrals to each of the
    other integrals allows us to simplify the expression above for the net flow <m>N</m> to be
    <me>
      (2h) \left(F_2(t^*_1,b+h)-F_2(t^*_2,b-h)+F_1(a+h,t^*_3)-F_1(a-h,t^*_1)\right)
    </me>, 
    where <m>t^*_1</m> and <m>t^*_2</m> are values in <m>(a-h,a+h)</m> and <m>t^*_3</m> and <m>t^*_4</m> are values in <m>(b-h,b+h)</m>. Thus our flow density can be measured by looking at the limit as <m>h\to 0</m> of the net flow (in or out) over the square divided by the area of the square.
    <md>
      <mrow>\amp\text{Flow Density}(a,b)=\lim_{h\rightarrow 0} \frac{\text{net flow}}{\text{area}} </mrow>
      <mrow>\amp = \lim_{h\rightarrow 0} \frac{(2h) \left(F_2(t^*_1,b+h)-F_2(t^*_2,b-h)+F_1(a+h,t^*_3)-F_1(a-h,t^*_1)\right)}{4h^2}</mrow>
    </md>.
  </p>
  <p>
    To simplify the limit further, we will reorganize our limit expression. Specifically, we collect the <m>F_2</m> and <m>F_1</m> terms separately. This gives
    <md>
      <mrow>\amp\text{Flow Density}(a,b) = </mrow>
      <mrow>\amp\lim_{h\rightarrow 0}\left[ \frac{F_1(a+h,t^*_3)-F_1(a-h,t^*_1)}{2h}+\frac{F_2(t^*_1,b+h)-F_2(t^*_2,b-h)}{2h}\right]</mrow>
    </md>.
    Recall the central difference method of estimating derivatives from <url href="https://activecalculus.org/single/sec-1-5-units.html#VjW" visual="activecalculus.org/single/sec-1-5-units.html#VjW">Section 1.5.2</url> and as <m>h\to 0</m>, the numbers <m>t^*_1,t^*_2</m> must go to <m>a</m> and <m>t^*_3,t^*_4</m> must go to <m>b</m>. Therefore, after evaluating our limit, the flow density is
    <me> 
      \text{Flow Density}(a,b)= \frac{\partial F_1}{\partial x} (a,b)+\frac{\partial F_2}{\partial y} (a,b)
    </me>.
  </p>
  <p>
    While this simplification may seem a bit amazing and magical, our conceptual steps should help us make sense of the result. If we are looking at how the strength of the vector field is changing in a small neighborhood of the point <m>(a,b)</m> then we only need to look how fast the horizontal component is changing horizontally and how the vertical component is changing vertically. How the horizontal component changes over small steps in the vertical direction will give us information about how the direction of the vector field changes but not how the
    strength of the vector field is changing.
  </p>
  <p>
    The arguments we made about measuring how much of the vector field flows into or out of a square has straightforward generalization to three (or more) dimensions. However, doing so requires a method for measuring how much of a vector field flows through a surface. This will be the subject of <xref ref="S_Vector_FluxInt"/>.
  </p>
</subsection>
<subsection>
  <title>Summary</title>
  <p>
    <ul>
      <li>
        <p>
          The divergence of a vector field <m>\vF(x,y)=\langle F_1(x,y),F_2(x,y)\rangle</m> is computed as
          <me>
            \divg(\vF)=\frac{\partial F_1}{\partial x}+\frac{\partial F_2}{\partial y}
          </me>
          In three dimensions, the divergence of the vector field
          <m>\vG(x,y)=\langle{G_1(x,y,z),G_2(x,y,z),G_3(x,y,z)}\rangle</m> is computed as
          <me> 
            \divg(\vG)=\frac{\partial G_1}{\partial x}+\frac{\partial G_2}{\partial y}+\frac{\partial G_3}{\partial z}
          </me>
        </p>
      </li>
      <li>
        <p>
          The divergence of a vector field measures the density of change in the strength of the vector field. In other words, the divergence measures the instantaneous rate of change in the strength of the vector field along the direction of flow.
        </p>
      </li>

      <li>
        <p>
          The accumulation of the divergence over a region of space will measure the net amount of the vector field that exits (versus enters) the region.
        </p>
      </li>
      <li><p>The key ideas when interpreting divergence are:
        <ul>
          <li>A positive divergence means that the vector field is growing in strength.</li>
          <li>A negative divergence means that the vector field is decreasing in strength.</li>
          <li>A zero divergence means that the vector field is not changing in strength.</li>
        </ul>
	</p>
      </li>
    </ul>
  </p>
</subsection>
  <xi:include href="exercises/ez-S_Vector_Div.ptx" />
<subsection component="instructor" >
  <title>Notes to Instructors and Dependencies</title>
  <p>
    This section relies heavily on understanding vector fields from <xref ref="S_Vector_VectorFields" />. We have separated the details of how the flux density of a region leads to the definition and understanding of the divergence (<xref ref="SS_Vector_Div_Development" />). The second subsection is optional, but is worthwhile reading for students who are interested in a good conceptual understanding of how divergence is developed.
  </p>
</subsection>
</section>
