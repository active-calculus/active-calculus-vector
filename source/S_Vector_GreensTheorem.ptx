<?xml version="1.0"?>
<section xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="S_Vector_GreensTheorem">
  <title>Green's Theorem</title>
  <objectives>
    <ul>
      <li>
        <p>
        	How can we calculate the circulation of a two-dimensional vector field <m>\vF</m> around a closed curve when <m>\vF</m> is not path-independent?
        </p>
      </li>

      <li>
        <p>
        	What is the meaning of the double integral of the circulation density of a smooth two-dimensional vector field on a region <m>R</m> bounded by a closed curve that does not intersect itself?
        </p>
      </li>

    </ul>
  </objectives>
  <introduction>
    <p>
      We know from <xref ref="S_Vector_FTCLI"/> that a vector field is path-independent if and only if the circulation around every closed curve in its domain is <m>0</m>. It is probably not surprising that, given the multitude of names we have for path-independent vector fields, they are important vector fields that arise frequently. However, not every vector field is path-independent, and many times we will want to calculate the circulation around a closed curve in a vector field that is not path-independent. This section explores a connection between line integrals and double integrals that you may find surprising. It will be the first of three major theorems that connect types of integrals that seem very different on the surface.
    </p>
    <exploration xml:id="PA_Vector_GreensTheorem">
      <introduction>
        <p>
        	We will consider the vector field <m>\vF = \langle 2y,3x^2 y\rangle</m>, which is defined on the entire <m>xy</m>-plane. Suppose that we want to calculate the circulation of <m>\vF</m> around the circle <m>C</m> of radius <m>2</m>, centered at <m>(0,0)</m>, and oriented counterclockwise.
        </p>
      </introduction>
      <task xml:id="task_PA_Vector_GreensTheorem_Circ">
        <statement>
          <p>
          	Verify that <m>\vF</m> is not path-independent by calculating the circulation of <m>\vF</m> around the circle <m>C</m>. The SageMath cell below is set up to assist you with this, but you will need to supply a parametrization of <m>C</m> on line 4.
          </p>
				<sage>
				<input>
					var('r,t,x,y')
					F = vector([2*y,3*x^2*y])
					#Supply a parametrization of C on the next line inside the [ ]
					C = vector([ , ])
					integral(F(x=C[0],y=C[1]).dot_product(derivative(C,t)),t,0,2*pi)
				</input>
				</sage>
        </statement>
        <answer>
	  		<p><m>-8\pi</m></p>
        </answer>
        <solution>
			<p>
				If we parametrize <m>C</m> as <m>\vr(t) = \langle 2\cos(t),2\sin(t)\rangle</m>, then <m>\oint_C \vF\cdot d\vr = -8\pi</m>. To use the SageMath cell to do this, make line 3 read <c>C = vector([2*cos(t),2*sin(t)])</c> and execute. Because the circulation around <m>C</m> is not <m>0</m>, we know that <m>\vF</m> is not path-independent. 
	  		</p>
        </solution>
      </task>
      <task xml:id="task_PA_Vector_GreensTheorem_Integrand">
        <statement>
          <p>
			Recall from <xref ref="S_Vector_Curl" /> that if <m>\vF = \langle F_1(x,y),F_2(x,y)\rangle</m> is a vector field, then the circulation density (in 2D) is given by
				<me> 
					\text{Circulation Density at the point }(a,b)= \frac{\partial F_2}{\partial x} (a,b)-\frac{\partial F_1}{\partial y} (a,b)
			  	</me>
			What is the circulation density of <m>\vF = \langle 2y,3x^2 y\rangle</m>? 

	    <!--Consider . In <xref ref="S_Vector_Curl"/>, we
	    discussed the circulation density of a two-dimensional
	    vector field at a given point and determined that it can
	    be algebraically determined by <m>\displaystyle
	    \frac{\partial F_2}{\partial x} - \frac{\partial
	    F_1}{\partial y}</m>. Calculate the circulation density
	    for this vector field.  Without doing any calculations, do
	    you think that the circulation density is <m>0</m> for all
	    values of <m>x</m> and <m>y</m>?  Calculate
	    <m>\displaystyle \frac{\partial F_2}{\partial x} -
	    \frac{\partial F_1}{\partial y}</m> to confirm your
	    answer.-->
	  </p>
        </statement>
        <answer>
	  <p>No; <m>6xy-2</m>.</p>
        </answer>
        <solution>
	  <p><!--Since <m>\vF</m> is not path independent, we know that
	  <m>\vF</m> is not a gradient vector field. Thus, we would
	  not expect the circulation density to be <m>0</m> for all
	  values of <m>x</m> and <m>y</m> as would be the case if
	  <m>\vF</m> were the gradient of a smooth function.--> Here we
	  have that <m>\partial F_2/\partial x =6xy</m> and
	  <m>\partial F_1/\partial y = 2</m>, so we have that
	  <m>\partial F_2/\partial x - \partial F_1/\partial y=
	  6xy-2</m>.
	  </p>
        </solution>
	</task>
	<task xml:id="task_PA_Vector_GreensTheorem_Region">
	  <statement>
	    <p>
			Sketch the curve <m>C</m> and shade the region it. Describe the region bounded by <m>C</m> in both rectangular and polar coordinates.
	    </p>
	  </statement>
	  <answer>
	    <p>Polar: <m>0\leq r\leq 2</m>, <m>0\leq \theta\leq  2\pi</m>. Rectangular: <m>-2\leq x\leq 2</m>, <m>-\sqrt{4-x^2}\leq y\leq \sqrt{4-x^2}</m>.
	    </p>
	  </answer>
	  <solution>
	    <p>
			Since we know the radius of <m>C</m> is <m>2</m>, the region the circle bounds is covered by all values of <m>r</m> with <m>0\leq r\leq 2</m>. For <m>\theta</m>, since we have the full disk, the bounds are <m>0\leq \theta\leq 2\pi</m>. In rectangular coordinates, the circle is <m>x^2+y^2=4</m>. The range for <m>x</m> is <m>-2\leq x\leq 2</m>, and solving the equation of the circle for <m>y</m> gives us <m>-\sqrt{4-x^2}\leq y\leq \sqrt{4-x^2}</m> as the bounds for <m>y</m>.
	    </p>
	  </solution>
	</task>
    <task xml:id="task_PA_Vector_GreensTheorem_Double">
        <statement>
	  		<p>
	    		Calculate the double integral of <m>\displaystyle \frac{\partial F_2}{\partial x} - \frac{\partial F_1}{\partial y}</m> over the region inside the circle <m>C</m>. This integral is not the most fun to do by hand, so a SageMath cell has been provided to assist you.
    		</p>
			<sage>
				<input>
				integral(integral( FUNCTION HERE , var1, start, stop), var2, start, stop)	      
				</input>
			</sage>
		</statement>
		<hint>
		<p>If you choose polar coordinates, use <m>\theta</m> for the first variable and <m>r</m> for the second variable.</p>
		</hint>
		<answer>
		<p><m>-8\pi</m></p>
		</answer>
		<solution>
		<p>
			Denote by <m>D</m> the region inside the circle <m>C</m>. We can describe <m>D</m> readily in polar coordinates with the inequalities <m>0\leq r \leq 2</m> and <m>0\leq \theta\leq 2\pi</m>. Thus, we need to calculate
			<md>
			<mrow>\iint_D \left(\frac{\partial F_2}{\partial x} -
			\frac{\partial F_1}{\partial y}\right)\, dA &amp;= \iint_D
			(6xy-2)\, dA</mrow>
			<mrow>&amp;= \int_0^2 \int_0^{2\pi}
			(6r^2\cos(\theta)\sin(\theta) - 2)r\, d\theta\, dr</mrow>
			</md>.
			Using SageMath to calculate this, we obtain <m>-8\pi</m>.
		</p>
		</solution>
    </task>
	<task>
		<statement>
			<p>
				What do you notice about your results to parts (a) and (d)? Do you think this will happen in general? Write a sentence or two about what you think is happening here.
			</p>
		</statement>
	</task>
</exploration>
<p>
	A natural question after completing the Preview Activity is if there is something special about the vector field <m>\vF</m> or the curve <m>C</m> that led to the results you obtained, and investigating this will be our principal task in this section.
</p>
</introduction>

<subsection xml:id="SS_Vector_GreensTheorem_Circulation">
    <title>Circulation</title>
    <p>
      In <xref ref="PA_Vector_GreensTheorem"/>, you integrated the circulation density of a smooth vector field over a disk and found the result was equal to the circulation of the vector field along the region's circular boundary. This relationship is the theme of this section. To see why this would make sense, consider the region <m>R</m> bounded by the curve <m>C</m> shown in <xref ref="fig_Vector_GreensTheorem_circ_cartoon"/>. We have placed a square grid inside <m>R</m> to suggest the idea of breaking <m>R</m> up into many smaller regions, most of which are square. This idea should make you think of the methods we have already seen of breaking up a region into smaller and smaller regions for Riemann sums.
    </p>
    <figure xml:id="fig_Vector_GreensTheorem_circ_cartoon">
      <caption>A region bounded by a curve</caption>
      <image xml:id="img_Vector_GreensTheorem_circ_cartoon" width="80%">
				<description>A bean-shaped region in the plane that is bounded by a closed curve. The curve is oriented so that when walking along the curve, the region is always on the left. There is a square grid dividing the up the interior of the region.</description>
				<latex-image>
					\begin{tikzpicture}[grid/.style={pattern=MyGrid}]
					\path[draw,use Hobby shortcut,closed=true,GridSize=9pt,pattern=MyGrid,fill opacity=0.5, orientation arrows]
					(0,0) .. (1,1) .. (2.3,0.5) .. (3.6,4) .. (0.5,3) .. (-0.7,2.1);
					
					\node at (2.25,1.99) {$R$};
					\node at (5,2.3) {$C$};
					\end{tikzpicture}
				</latex-image>
      </image>
    </figure>
    <p>
      The critical idea here is that if we integrate the circulation <em>density</em> over each of the small regions and add those up, this is the same as integrating the circulation density over the entirety of the region <m>R</m> because of the fundamental properties of integrals. Also, integrating circulation <em>per
      unit area</em> over a two-dimensional region should be related to the total circulation on that region. Now look at <xref ref="fig_Vector_GreensTheorem_circ_squares2" /> and think of these two square regions as being two of the square regions inside <m>R</m> in <xref ref="fig_Vector_GreensTheorem_circ_cartoon" />.
    </p>
    <figure xml:id="fig_Vector_GreensTheorem_circ_squares2">
      <caption>A square region divided into two smaller squares</caption>
      <image xml:id="img_Vector_GreensTheorem_circ_squares2.pdf" width="40%">
				<description>A rectangular region in the plane that is bounded by a closed curve oriented counterclockwise. The square is divided into two squares of equal size, which are labeled as <m>R_1</m> and <m>R_2</m>. There are circular arrows inside each of the smaller regions indicating counterclockwise orientations.</description>
				<latex-image>
					\begin{tikzpicture}
					\draw [thick,orientation arrows] (0,0) -- (4,0) -- (4,2) -- (0,2) -- (0,0);
					\draw [thick] (2,0) -- (2,2);
					\draw [thick] (0,2) -- (2,2);
					\draw (0.1,0.85) arc (-170:170:0.9cm);
					\draw (2.1,0.85) arc (-170:170:0.9cm);
					%\draw (0.1,2.85) arc (-170:170:0.9cm);
					%\draw (2.1,2.85) arc (-170:170:0.9cm);
					\draw[arrow at end=>] (0.1,0.85) arc (-170:170:0.9cm);
					\draw[arrow at end=>] (2.1,0.85) arc (-170:170:0.9cm);
					%\draw[arrow at end=>] (0.1,2.85) arc (-170:170:0.9cm);
					%\draw[arrow at end=>] (2.1,2.85) arc (-170:170:0.9cm);
					\node at (1,1) {$R_1$};
					\node at (3,1) {$R_2$};
					%\node at (1,1) {$R_3$};
					%\node at (3,1) {$R_4$};											
					\end{tikzpicture}
				</latex-image>
      </image>
    </figure>
    <p>
      We orient the boundary <m>C_i</m> of square region <m>R_i</m> in the manner suggested by the circular arrows. This means that the vertical boundary in common between <m>R_1</m> and <m>R_2</m> is oriented <em>up</em> when we calculate the line integral <m>\oint_{C_1}\vF\cdot d\vr</m> and oriented <em>down</em> when
      we evaluate <m>\oint_{C_2}\vF\cdot d\vr</m>. Thus, this line  segment does not contribute to the sum
      <m>\oint_{C_1}\vF\cdot d\vr + \oint_{C_2}\vF\cdot d\vr</m>. Therefore, <me>\oint_{C_1}\vF\cdot d\vr + \oint_{C_2}\vF\cdot d\vr </me>
      is equal to the line integral of <m>\vF</m> along the boundary of the large rectangle.
    </p>
    <p>
      Returning to <xref ref="fig_Vector_GreensTheorem_circ_cartoon"/>, if we find the circulation along the boundary of each of the smaller regions, the line integrals
      along the boundaries that lie inside the region <m>R</m> will all offset. Thus the value should equal <m>\oint_C\vF\cdot d\vr</m>. If we make our grid fine enough, all of the smaller regions into which <m>R</m> is divided will be very close to rectangular. 
    </p>
    <!-- <activity xml:id="act_Vector_GreensTheorem_rectangle">
      <introduction>
	<p>
	  For this activity, we will consider the region <m>R</m> satisfying <m>a\leq x\leq c</m> and <m>b\leq y\leq
	  d</m>. The rectangular curve <m>C</m> will be the boundary
	  of <m>R</m>, oriented counterclockwise. Let <m>\vF = \langle
	  F_1(x,y),F_2(x,y)\rangle</m> be a vector field that is
	  smooth on <m>C</m> and <m>R</m>. We can write <m>C = C_1 +
	  C_2 + C_3 + C_4</m>, where <m>C_1</m> is the top edge of the
	  rectangle and the edges are numbered counterclockwise around
	  the rectangle.
	</p>
      </introduction>
      <task>
	<statement>
	  <p>Sketch the region <m>R</m> and curves
	  <m>C_1,C_2,C_3,C_4</m>. Label the four corners of <m>R</m>
	  with the coordinates of the vertices, and be sure to
	  indicate the proper orientation on <m>C</m>.</p>
	</statement>
      </task>
      <task>
	<statement>
	  <p>
	    Since we know that <me>\oint_C\vF\cdot d\vr =
	    \int_{C_1}\vF\cdot d\vr + \int_{C_2}\vF\cdot d\vr +
	    \int_{C_3}\vF\cdot d\vr + \int_{C_4}\vF\cdot d\vr</me>, it
	    makes sense to parametrize each curve <m>C_i</m> and
	    write <m>\int_{C_i}\vF\cdot d\vr</m> as a one-variable
	    integral. For example, <m>C_1</m> can be parametrized as
	    <m>\vr(x) = \langle c+a-x,d\rangle</m> with <m>a\leq x\leq
	    c</m>. Thus, we have
	    <me>\int_{C_1}\vF\cdot d\vr = \int_a^c \langle
	    F_1(x,d),F_2(x,d)\rangle\cdot \langle -1,0\rangle\,
	    dx</me>. Complete this process to write the integrals for
	    the remaining three sides as integrals with respect to
	    <m>x</m> or <m>y</m>, as appropriate.
	  </p>
	</statement>
	<answer>
	  <p>
	    <md>
	      <mrow>
		\int_{C_2}\vF\cdot d\vr &amp;= \int_b^d \langle
		F_1(a,y),F_2(a,y)\rangle\cdot \langle 0,-1\rangle\, dy
	      </mrow>
	      <mrow>
		\int_{C_3}\vF\cdot d\vr &amp;= \int_a^c \langle
		F_1(x,b),F_2(x,b)\rangle\cdot \langle 1,0\rangle\, dy
	      </mrow>
	      <mrow>
		\int_{C_4}\vF\cdot d\vr &amp;= \int_b^d \langle
		F_1(c,y),F_2(c,y)\rangle\cdot \langle 0,1\rangle\, dy
	      </mrow>
	    </md>
	  </p>
	</answer>
	<solution>
	  <p>The parametrizations rely on fixing <m>x=a</m> for
	  <m>C_2</m>, <m>y=b</m> for <m>C_3</m>, and <m>x=d</m> for
	  <m>C_4</m>. 
	    <md>
	      <mrow>
		\int_{C_2}\vF\cdot d\vr &amp;= \int_b^d \langle
		F_1(a,y),F_2(a,y)\rangle\cdot \langle 0,-11\rangle\, dy
	      </mrow>
	      <mrow>
		\int_{C_3}\vF\cdot d\vr &amp;= \int_a^c \langle
		F_1(x,b),F_2(x,b)\rangle\cdot \langle 1,0\rangle\, dy
	      </mrow>
	      <mrow>
		\int_{C_4}\vF\cdot d\vr &amp;= \int_b^d \langle
		F_1(c,y),F_2(c,y)\rangle\cdot \langle 0,1\rangle\, dy
	      </mrow>
	    </md>	    
	  </p>
	</solution>
      </task>
      <task>
	<statement>
	  <p>
	    Write <m>\oint_C\vF\cdot d\vr</m> as the sum of two
	    one-variable integrals (one with respect to <m>x</m> and
	    one with respect to <m>y</m>).
	  </p>
	</statement>
	<answer>
	  <p>
	    <m>\displaystyle\oint_C\vF\cdot d\vr = \int_b^d
	    \left(F_2(c,y) - F_2(a,y)\right)\, dy +
	    \int_a^c\left(F_1(x,b)-F_1(x,d)\right)\, dx</m>
	  </p>
	</answer>
	<solution>
	  <p>Because the limits of integration for the <m>dx</m>
	  integrals match and the limits of integration for the
	  <m>dy</m> integrals match, we can add and obtain
	    <m>\displaystyle\oint_C\vF\cdot d\vr = \int_b^d
	    \left(F_2(c,y) - F_2(a,y)\right)\, dy +
	    \int_a^c\left(F_1(x,b)-F_1(x,d)\right)\, dx</m>.
	  </p>
	</solution>
      </task>
      <task>
	<statement>
	  <p>
	    We would like to see if the equality of the line integral
	    and double integral in <xref ref="PA_Vector_GreensTheorem"/> was a coincidence or holds for more
	    general vector fields. (Soon we will expand our
	    curves beyond rectangles, but for the moment, we focus
	    on the curve <m>C</m> and region <m>R</m>.) To do this, we
	    have to find some way to take our answer to the previous
	    part of this activity, which includes two single integrals
	    and turn them into a double integral over the rectangle
	    <m>R</m>. 
	  </p>
	  <p>
	    We have assumed that <m>\vF</m> is smooth on <m>C</m> and
	    <m>R</m>, so the partial derivatives <m>\partial
	    F_2/\partial x</m> and <m>\partial F_1/\partial y</m> are
	    continuous functions on <m>C</m> and <m>R</m>. Rewrite the
	    expression you have for <m>\oint_C\vF\cdot d\vr</m> in the
	    previous step as the sum of two <em>double</em>
	    integrals. 
	  </p>
	</statement>
	<hint>
	  <p>
	    With <m>x</m> fixed, the integrand in your <m>dx</m>
	    integral matches what you see on the left-hand side of the
	    <url href="https://activecalculus.org/single/sec-4-4-FTC.html#wtR" visual="activecalculus.org/single/sec-4-4-FTC.html#wtR">Total Change Theorem</url>, but
	    now instead of prime notation for the derivative, you will
	    have a partial derivative with respect to <m>y</m>.
	  </p>
	</hint>
	<answer>
	  <p>
	    <m>
	      \displaystyle \oint_C\vF\cdot d\vr = \int\limits_b^d\!\! \int\limits_{a\mathstrut}^c
	      \frac{\partial F_2}{\partial x}(x,y)\, dx\, dy +
	      \int\limits_{a\mathstrut}^c\!\! \int\limits_d^b \frac{\partial F_1}{\partial y}(x,y)\, dy\, dx
	    </m>
	  </p>
	</answer>
	<solution>
	  <p>By the <url href="https://activecalculus.org/single/sec-4-4-FTC.html#wtR" visual="activecalculus.org/single/sec-4-4-FTC.html#wtR">Total Change Theorem</url>,
	  with <m>y</m> fixed, we have that
	  <md>
	    <mrow>F_2(c,y) - F_2(a,y) &amp;=
	    \int_a^c \frac{\partial F_2}{\partial x}(x,y)\,
	    dx\text{.}</mrow>
	    <intertext>Similarly,</intertext>
	    <mrow>F_1(x,b) - F_1(x,d) &amp;=
	    \int_d^b \frac{\partial F_1}{\partial y}(x,y)\,
	    dy\text{.}</mrow>
	  </md>
	  Therefore, we have
	    <me>
	      \oint_C\vF\cdot d\vr = \int\limits_b^d\!\! \int\limits_{a\mathstrut}^c
	      \frac{\partial F_2}{\partial x}(x,y)\, dx\, dy +
	      \int\limits_{a\mathstrut}^c\!\! \int\limits_d^b \frac{\partial F_1}{\partial y}(x,y)\, dy\, dx
	    </me>.
	  </p>
	</solution>
      </task>
      <task>
	<statement>
	  <p>
	    Rewrite your sum of two double integrals in the previous
	    step above as a double integral over the rectangle
	    <m>R</m>, thereby showing that the line integral of
	    <m>\vF</m> along the curve <m>C</m> is equal to a double
	    integral of the region inside <m>C</m>.
	  </p>
	</statement>
	<answer>
	  <p>
	    <m>\displaystyle\oint_C\vF\cdot d\vr = \iint_R
	    \left(\frac{\partial F_2}{\partial x}- \frac{\partial
	    F_1}{\partial y}\right)\, dA</m>
	  </p>
	</answer>
	<solution>
	  <p>
	    After interchanging the order of integration so that both
	    integrals are done <m>dx\, dy</m>, the other step we must
	    do to add them is to make the integral of <m>\partial
	    F_1/\partial y</m> have lower limit
	    <m>b</m> and upper limit <m>d</m> (with respect to
	    <m>y</m>). We do this by multiplying by <m>-1</m> and then
	    can add the integrals to obtain
	    <me>\displaystyle\oint_C\vF\cdot d\vr = \iint_R
	    \left(\frac{\partial F_2}{\partial x}- \frac{\partial
	    F_1}{\partial y}\right)\, dA</me>.
	  </p>
	</solution>
      </task>
      <conclusion>
	<p>
	  Now we can see that our result in <xref ref="PA_Vector_GreensTheorem"/> was not
	  a coincidence and integrating the circulation
	  <em>density</em> of a smooth vector field on a rectangular
	  region gives the same result as calculating the circulation
	  along the boundary of the region.
	</p>
      </conclusion>
    </activity> -->

    <!-- <p>
      The phenomenon we verified for rectangular regions in <xref ref="act_Vector_GreensTheorem_rectangle"/>
      is a more general result that will be the subject of our next
      section. 
    </p> -->
	<p>
		The calculation of circulation around a nice closed curve will be the sum of the circulation over pieces that enclose the same area, regardless of the size or number of the pieces used. In other words, 
		<me>\oint_C \vF \cdot d\vr = \sum_{R_i} \oint_{C_i} \vF\cdot d\vr</me>
		where <m>C_i</m> is a bounding curve for subregion <m>R_i</m>. We defined our circulation density as the ratio of circulation to area, so we can also subsititute the circulation around a region for the circulation density times the area of that region. Additionally, we can take the limit as our regions get smaller, since size and the number of regions does not affect the sum. Letting <m>\Delta R_i</m> represent the area of region <m>R_i</m> with boundary curve <m>C_i</m>, we have
		<md>
			<mrow>\oint_C \vF \cdot d\vr \amp = \lim_{\Delta R_i \rightarrow 0} \sum_{R_i} \oint_{C_i} \vF\cdot d\vr </mrow>
			<mrow> \amp = \lim_{\Delta R_i \rightarrow 0} \sum_{R_i} \left(\frac{\partial F_2}{\partial x}-\frac{\partial F_1}{\partial y}\right) \Delta R_i</mrow>
		</md>.
		This expression should look familiar as the Reimann sum definition for the double integral of <m>\frac{\partial F_2}{\partial x}-\frac{\partial F_1}{\partial y}</m> over the region <m>R</m>. For <q>nice</q> closed curves we can equate the circulation around the boundary (computed as a line integral) with a double integral of the circulation density over the region enclosed (computed with a double integral). 
	</p>
  </subsection>

  <subsection>
    <title>Green's Theorem</title>
    <p>
		So far in this section, we have restricted ourselves to relatively nice closed curves when thinking about circulation. While the main theorem of this section will not allow us to consider arbitrary closed curves, it does cover more varied curves than we have discussed so far. A <term>simple closed curve</term> is a closed curve that does not cross itself, and these are the curves to which our next theorem applies.
	</p>
    <aside>
      <title>A closed curve that is not simple</title>
      	<p>
			The restriction that the curve in <xref ref="thm_Green" text="title"/> prohibits curves such as the one below, which crosses itself.
		</p>
		<image xml:id="image_Vector_GreensTheorem_FigureEight">
			<description>A curve in the shape of a figure eight</description>
			<sageplot>
				var('x,y,t')
				a=pi/6
				plot1=parametric_plot((sin(2*t),cos(t)),(t,0,2*pi),color="blue",thickness=1.5,axes_labels=["$x$","$y$"])+arrow((sin(2*a),cos(a)),(sin(2*(a-0.05)),cos(a-0.05)),color="blue")
				final_plot1=plot1
				final_plot1				
			</sageplot>
		</image>
    </aside>
    <theorem xml:id="thm_Green">
      <title>
		Green's Theorem
      </title>
      <statement>
		<p>
			Let <m>C</m> be a simple closed curve in the plane that	bounds a region <m>R</m> with <m>C</m> oriented in such a way that when walking along <m>C</m> in the direction of its orientation, the region <m>R</m> is on our left. Suppose that <m>\vF=\langle F_1,F_2\rangle</m> is vector field with continuous partial derivatives on the region <m>R</m> and its boundary <m>C</m>. The circulation of <m>\vF</m> along <m>C</m> may be calculated as
				<me>\oint_C \vF\cdot d\vr = \iint_R \left(\frac{\partial F_2}{\partial x} -	\frac{\partial F_1}{\partial y}\right)\, dA</me>.
			</p>
      </statement>
    </theorem>
	
    <!--<p>
      In <xref ref="act_Vector_GreensTheorem_rectangle"/>, we showed that <xref ref="thm_Green" text="title"/> holds when the region <m>R</m> is a rectangle
      with sides parallel to the coordinate axes. The discussion that
      introduced the previous subsection may have you convinced that
      <xref ref="thm_Green" text="title"/> holds in its full
      form. Although our argument there was not a rigorous proof, we
      will not say more about why this theorem is true in full
      generality.  TODO In
      <xref ref="ez_Vector_GreensTheorem_ParamRect" 
      />, we will examine how a change of coordinates can give us a
      proof for regions that can be parametrized by rectangles.
    </p> -->
    
    <p>
      At first glance, it may seem that <xref ref="thm_Green" text="title"/> is of purely intellectual interest. However, we have already encountered situations where parameterizing a curve can be complicated. This is particularly true when the curve has <q>corners</q> that require us to give separate parametrizations for several pieces of the curve, such as with the rectangular curve pictured in <xref ref="fig_Vector_GreensTheorem_Rectangle"/>. However, as with this rectangle, is often the case that a curve that is difficult to parametrize bounds a region that is not too complex to describe using rectangular or polar coordinates. For instance, the rectangular region in <xref ref="fig_Vector_GreensTheorem_Rectangle"/> can be described as <m>1\leq x\leq 4</m> and <m>2\leq y\leq 4</m>, which is a simpler description than needing to parameterize each of the four sides of the rectangle separately. Additionally, the integrand of the double integral in <xref ref="thm_Green" text="title"/> involves partial derivatives that can sometimes result in an integrand that is easy to work with. The purpose of <xref ref="thm_Green" text="title"/> is, at its core, to allow you to exchange one type of integration problem (a line integral) for another type of integration problem (a double integral). This will be a
      recurring theme as this chapter continues.
    </p>
    <figure xml:id="fig_Vector_GreensTheorem_Rectangle">
      <caption>A rectangular curve</caption>
      <image width="55%" xml:id="image_Vector_GreensTheorem_rectangle">
				<description>
					A rectangular curve in the <m>xy</m>-plane. The lower-left corner is labeled <m>(1,2)</m>. The upper-right corner is labeled <m>(4,4)</m>. The curve is oriented
					counterclockwise.
				</description>
				<sageplot>
					var('x','t');
					d=1
					plot1= parametric_plot((2+2*d*d,3+d*t),(t,-d,d),color='blue',axes_labels=["$x$","$y$"],frame=False,aspect_ratio=1,ticks=[[],[]],thickness=3,xmin=-.5,xmax=5,ymin=-.5,ymax=5)
					plot1+= parametric_plot((2-d*d,3+d*t),(t,-d,d),color='blue',axes_labels=["$x$","$y$"],frame=False,aspect_ratio=1,ticks=[[],[]],thickness=3)
					plot1+= parametric_plot((2+d*t,3+d*d),(t,-d,2*d),color='blue',axes_labels=["$x$","$y$"],frame=False,aspect_ratio=1,ticks=[[],[]],thickness=3)
					plot1+= parametric_plot((2+d*t,3-d*d),(t,-d,2*d),color='blue',axes_labels=["$x$","$y$"],frame=False,aspect_ratio=1,ticks=[[],[]],thickness=3)
					plot1+= text("$(1,2)$",(1,1.75),color='black',fontsize='x-large',clip=True,xmin=-.5,xmax=5,ymin=-.5,ymax=5)+text("$(4,4)$",(4,4.25),color='black',fontsize='x-large',clip=True,xmin=-.5,xmax=5,ymin=-.5,ymax=5)
					plot1+=arrow((2+2*d^2,3+d*(-0.5)),(2+2*d^2,3+d*(+0.5)),color='blue')
					plot1+=arrow((2-d^2,3-d*(-0.5)),(2-d^2,3-d*(+0.5)),color='blue')
					plot1+=arrow((2-d*(-1/2),3+d*d),(2-d*1/2,3+d*(d)),color='blue')
					plot1+=arrow((2+d*(-1/2),3-d*d),(2+d*1/2,3-d*(d)),color='blue')
					plot1					
				</sageplot>
      </image>
    </figure>
	<example>
		<p>
			We will verify Green's Theorem by computing both sides of the equation separately when <m>\vF =\langle x^2-xy,y^2-2x \rangle </m> and <m>C</m> is the bounding curve given in <xref ref="fig_Vector_GreensTheorem_Rectangle" />.
		</p>
		<p>
			First, we calculate the double integral (the right hand side of the equation in Green's Theorem). The circulation density of <m>\vF = \langle x^2-xy,y^2-2x \rangle </m> will be <m>-2+x</m>, which is continuous everywhere in the region <m>R</m>. Our iterated itegral becomes
			<md>
				<mrow>\iint_R \left(\frac{\partial F_2}{\partial x} -	\frac{\partial F_1}{\partial y}\right)\, dA \amp = \int_2^4 \int_1^4 (-2+x) \, dx \, dy </mrow>
				<mrow> \amp = \int_2^4    \left[-2x+x^2/2\right]_{x=1}^{x=4} \, dy </mrow>
				<mrow> \amp = \int_2^4 \frac{3}{2} \, dy </mrow>
				<mrow> \amp = 3 </mrow>
			</md>
			Note how easy it is to set up and evaluate this double integral.
		</p>
		<p>
			We will need to compute the line integral of <m>\vF</m> over the four segements of the bounding rectangle. We will use the following parameterizations:
			<md>
				<mrow>\vr_{\text{bottom}}(t) \amp = \langle 1+3t,2 \rangle </mrow>
				<mrow>\vr_{\text{right}}(t) \amp = \langle 4,2+2t \rangle </mrow>
				<mrow>\vr_{\text{top}}(t) \amp = \langle 4-3t,4 \rangle </mrow>
				<mrow>\vr_{\text{left}}(t) \amp = \langle 1,4-2t \rangle </mrow>
			</md>
			where each paramterization uses <m>0\leq t\leq 1</m>. These parameterizations will yeild the following line integrals:
			<md>
				<mrow>\int_{\text{bottom}} \vF \cdot d\vr \amp = \int_0^1 ( (1+3t)^2 -(1+3t)(2) ) 3 \, dt = 6 </mrow>
				<mrow>\int_{\text{right}} \vF \cdot d\vr \amp = \int_0^1 ( (2+2t)^2 -(2)(4) ) 2 \, dt = 8/3  </mrow>
				<mrow>\int_{\text{top}} \vF \cdot d\vr \amp = \int_0^1 ( (4-3t)^2 -(4-3t)(4) ) (-3) \, dt = 9 </mrow>
				<mrow>\int_{\text{left}} \vF \cdot d\vr \amp = \int_0^1 ( (4-2t)^2 -(2)(1) ) (-2) \, dt = -44/3  </mrow>
			</md>
			Note that the sum of these line integrals is 3, and thus Green's Theorem is verified for our case since 
			<me>\oint_C \vF\cdot d\vr = 3 = \iint_R \left(\frac{\partial F_2}{\partial x} -	\frac{\partial F_1}{\partial y}\right)\, dA</me>
		</p>
	</example>

    <activity xml:id="act_Vector_GreensTheorem_verify">
      <introduction>
		<p>
			For each of the curves described below, find the circulation of the given vector field around the curve. Do this both by calculating the line integral directly as well as by calculating the double integral from <xref ref="thm_Green" text="title"/>.
		</p>
      </introduction>
      <task>
		<statement>
		<p>
			The curve <m>C_1</m> is the circle of radius <m>3</m> centered at the point <m>(2,1)</m> (oriented counterclockwise) and the vector field is <m>\vF = \langle
			y^2, 5x+2xy\rangle</m>.
		</p>
		</statement>
		<answer>
		<p><m>45\pi</m></p>
		</answer>
		<solution>
			<p>Here we find that <me>\frac{\partial F_2}{\partial x} - \frac{\partial F_1}{\partial y} = (5+2y)-2y = 5</me>. Therefore, the integrand in <xref ref="thm_Green" text="title"/> is the constant <m>5</m>. Thus, the circulation of <m>\vF</m> around <m>C</m> is <m>5</m> times the area of the region inside <m>C</m>. That area is <m>\pi\cdot 3^2 = 9\pi</m>, which means that the circulation is <m>45\pi</m>.</p>
		</solution>
      </task>
      <task>
		<statement>
		<p>
			The curve <m>C_2</m> is the triangle with vertices <m>(0,0)</m>, <m>(3,0)</m>, and <m>(3,3)</m> (oriented counterclockwise) and the vector field is <m>\vG = \langle y^2, 3xy\rangle</m>.
		</p>
		</statement>
		<answer>
			<p><m>27/6</m></p>
		</answer>
		<solution>
			<p>
				Here we find that <me>\frac{\partial F_2}{\partial x} - \frac{\partial F_1}{\partial y} = 3y-2y = y</me>. The region inside <m>C_2</m> can be described by <m>0\leq x\leq 3</m> and <m>0\leq y\leq x</m>. Therefore, by <xref ref="thm_Green" text="title"/>, we have <me>\oint_{C_2} \vG\cdot d\vr  = \int_0^3\!\int_0^x y\, dy\,	dx = \int_0^3 \left.\frac{y^2}{2}\right|_0^x\, dx = \int_0^3 \frac{x^2}{2}\, dx = \left.\frac{x^3}{6}\right|_0^3 = \frac{27}{6}</me>.
			</p>
		</solution>
      </task>
    </activity>
    <p>
      Generally, <xref ref="thm_Green" text="title"/> is useful for allowing us to calculate line integrals by instead calculating a double integral. Going the other direction is harder, since finding a vector field <m>\langle F_1,F_2\rangle</m> so that <m>\partial F_2/\partial x - \partial F_1/\partial y</m> is equal to the integrand in the double integral can be difficult. However, the exercises will explore some situations where calculating a suitable line integral is a viable
      alternative to the double integral.
    </p>
  </subsection>

  <subsection>
    <title>What happens when vector fields are not smooth?</title>
    <p>
      Notice that the assumptions in <xref ref="thm_Green" text="title"/> require that the region <m>R</m> be bounded by a
      simple closed curve <m>C</m> and that the vector field have continuous
      partial derivatives on <m>R</m> and <m>C</m>. In <xref ref="ez_Vector_GreensTheorem_region_hole" text="type-local"/>, we will explore what happens when the region <m>R</m> 
      cannot be bounded by a simple closed
      curve, as sometimes multiple applications of <xref ref="thm_Green" text="title"/> can be used in those circumstances. Now,
      however, we will take a look at what happens in some cases where the vector
      field <m>\vF</m> is not smooth.
    </p>

    <activity xml:id="act_Vector_GreensTheorem_not_smooth">
      <introduction>
	<p>Consider the vector field <m>\vF =
	\displaystyle\frac{-y}{{x^2+y^2}}\vi +
	\frac{x}{{x^2+y^2}}\vj</m>. Notice that <m>\vF</m> is smooth
	everywhere in the plane other than at the point
	<m>(0,0)</m>. This vector field is plotted in <xref ref="fig_Vector_GreensTheorem_ccw_field"/>,
	but we have not plotted the vectors close to the origin as
	their magnitudes get so large that they make it hard to
	interpret the figure. Here <xref ref="thm_Green" text="title"/> applies to any simple closed curve <m>C</m> that
	    neither passes through <m>(0,0)</m> nor bounds a region
	    containing <m>(0,0)</m>. </p>
	<figure xml:id="fig_Vector_GreensTheorem_ccw_field">
	  <caption>The vector field <m>\vF</m></caption>
	  <image xml:id="img_Vector_GreensTheorem_ccw_field" width="65%">
	    <description>
				A vector field with vectors tangent to circles oriented counterclockwise and centered at the origin as well as the unit circle centered at the origin and oriented counterclockwise. The vectors are longer close to the origin and shorter farther from the origin.
			</description>
			<sageplot>
				var('x,y,t')
				F = (-y/((x^2+y^2)),x/((x^2+y^2)))
				F_control = [lambda x,y: F[0].subs(x=x,y=y) if x^2 + y^2 > 0.1 else None,
									 lambda x,y: F[1].subs(x=x,y=y) if x^2 + y^2 > 0.1 else None]
				plot1=plot_vector_field(F_control,(x,-1.5,1.5),(y,-1.5,1.5),color="blue",frame=False,xmin=-1.52,xmax=1.52,ymin=-1.52,ymax=1.52,aspect_ratio=1,axes_labels=["$x$","$y$"])
				plot2=parametric_plot((cos(t),sin(t)),(t,0,2*pi),color="red",thickness=1.5,axes_labels=["$x$","$y$"])+arrow((1/sqrt(2),1/sqrt(2)),(1/sqrt(2)-0.05,1/sqrt(2)+0.05),color="red")+text("$C$",(1.05,0.6),color='red',background_color='white',fontsize='x-large',clip=True)
				final_plot1=plot1+plot2
				final_plot1				
			</sageplot>
	  </image>
	</figure>
      </introduction>
      <task>
	<statement>
	  <p>
	    Find the circulation density of
	    <m>\vF</m> (i.e., the integrand of the double
	    integral in <xref ref="thm_Green" text="title"/>).
	  </p>
	</statement>
	<hint>
	  <p>Make sure to note any exceptional points at which your
	  formula is not valid.</p>
	</hint>
	<answer>
	  <p><m>\displaystyle\frac{\partial F_2}{\partial x} - \frac{\partial
	  F_1}{\partial y} = 0</m> for <m>(x,y)\neq(0,0)</m></p>
	</answer>
	<solution>
	  <p>For <m>(x,y)\neq (0,0)</m>, we have
	  <md>
	    <mrow>\frac{\partial F_2}{\partial x} &amp; =
	    -\frac{2x^{2}}{{\left(x^{2} + y^{2}\right)}^{2}}
	    + \frac{1}{{x^{2} + y^{2}}} = \frac{y^2-x^2}{{\left(x^{2} + y^{2}\right)}^{2}}</mrow>
	    <mrow>\frac{\partial F_1}{\partial y} &amp; =
	    \frac{2y^{2}}{{\left(x^{2} + y^{2}\right)}^{2}} -
	    \frac{1}{{x^{2} + y^{2}}} = \frac{y^2-x^2}{{\left(x^{2} + y^{2}\right)}^{2}}</mrow>
	    </md>. Thus,
	  <me>\frac{\partial F_2}{\partial x} - \frac{\partial F_1}{\partial y} = 0</me>.</p>
	</solution>
      </task>
      <task>
	<statement>
	  <p>
	    Suppose that <m>C</m> is the unit circle centered at the
	    origin. Without doing any calculations, what can you say
	    about <m>\oint_C \vF\cdot d \vr</m>? what does this
	    tell you about if <m>\vF</m> is path-independent?
	  </p>
	</statement>
	<answer>
	  <p>Positive; <m>\vF</m> is not path-independent</p>
	</answer>
	<solution>
	  <p>Notice that <m>\vF</m> is tangent to <m>C</m>. Thus,
	  <m>\oint_C \vF\cdot d \vr</m> must be positive. (In fact,
	  the circulation of <m>\vF</m> along <m>C</m> is the length
	  of <m>C</m> or <m>2\pi</m> because <m>\vF</m> consists of
	  unit vectors and the vector field is is tangent to
	  <m>C</m>.) Since there is a closed curve with nonzero
	  circulation, <m>\vF</m> is not path independent.</p>
	</solution>
      </task>
      <task>
	<statement>
	  <p>What would you get if you integrated the circulation
	  density of <m>\vF</m> over the region bounded by <m>C</m>?</p>
	</statement>
	<answer><p><m>0</m></p></answer>
	<solution>
	  <p>The circulation density is <m>0</m> everywhere inside
	  <m>C</m> except at the origin, where it is undefined. That
	  single point does not impact the value of the double
	  integral of the circulation density, which is thus <m>0</m>.
	  </p>
	</solution>
      </task>
      <task>
	<statement>
	  <p>Do the previous two parts contradict <xref ref="thm_Green" text="title"/>? Explain your reasoning.</p>
	</statement>
	<answer>
	  <p>No.</p>
	</answer>
	<solution>
	  <p>There is no contradiction because <xref ref="thm_Green" text="title"/> does not apply here. The region
	  <m>R</m> inside the curve <m>C</m> includes the point
	  <m>(0,0)</m>, and <m>\vF</m> is not defined at that
	  point. Green's Theorem requires that the vector field be
	  smooth at every point of <m>R</m>.</p>
	</solution>
      </task>
      <task>
	<statement>
	  <p>Is the vector field <m>\vG =
	  \displaystyle\frac{x}{x^2+y^2}\vi +\frac{y}{x^2+y^2}\vj</m>,
	  which is shown in <xref ref="fig_Vector_GreensTheorem_outward_field"/>, 
	  path-independent? Why or why not?</p>
	  <figure xml:id="fig_Vector_GreensTheorem_outward_field">
	    <caption>
	      The vector field <m>\vG</m>
	    </caption>
	    <image xml:id="img_Vector_GreensTheorem_outward_field" width="65%">
	      <description>
					A vector field with vectors radiating from the origin and orthogonal to circles centered at the origin. Vectors are longest near the origin and get shorter farther from the origin.
	      </description>
				<sageplot>
					var('x,y,t')
					F = (x/((x^2+y^2)),y/((x^2+y^2)))
					F_control = [lambda x,y: F[0].subs(x=x,y=y) if x^2 + y^2 > 0.1 else None,
										 lambda x,y: F[1].subs(x=x,y=y) if x^2 + y^2 > 0.1 else None]
					plot3=plot_vector_field(F,(x,-1.5,1.5),(y,-1.5,1.5),color="blue",frame=False,xmin=-1.52,xmax=1.52,ymin=-1.52,ymax=1.52,aspect_ratio=1,axes_labels=["$x$","$y$"])
					final_plot2=plot3
					final_plot2					
				</sageplot>
	    </image>
	  </figure>
	</statement>
	<answer>
	  <p>Yes</p>
	</answer>
	<solution>
	  <p>Let <m>g(x,y) = \frac{1}{2}\ln(x^2+y^2)</m>. Note that
	  <m>\grad g = \vG</m>, and the domain of <m>g</m> is the same
	  as the domain of <m>\vG</m> (all of <m>\R^2</m> except
	  <m>(0,0)</m>). Thus, <m>\vG</m> is a gradient vector
	  field and is therefore path-independent.</p>
	</solution>
      </task>
      <task>
	<statement>
	  <p> Suppose that <m>C</m> is the unit circle centered at the
	  origin. Find <m>\oint_C \vG\cdot d \vr</m>. Can you do this
	  using <xref ref="thm_Green" text="title"/>?
	  </p>
	</statement>
	<answer>
	  <p><m>0</m>; No</p>
	</answer>
	<solution>
	  <p>We have already shown that <m>\vG</m> is
	  path-independent, and therefore <m>\oint_C \vG\cdot d\vr =
	  0</m> since <m>C</m> is a closed curve. Because <m>\vG</m>
	  is not defined at the origin, <xref ref="thm_Green" text="title"/> does not apply to this line integral.</p>
	</solution>
      </task>

    </activity>

    <p>We can now see that <xref ref="thm_Green" text="title"/> is a
    powerful tool. However it cannot be used for all line
    integrals. In particular, the restriction that the vector field be
    smooth on the entire region bounded by a simple closed curve
    <m>C</m> creates limitations. This can occur even in cases where
    holes in the vector field's domain or points where the vector
    field is not continuously differentiable lie away from <m>C</m>.
    </p>
  </subsection>

  <subsection>
    <title>Summary</title>
    <p>
      <ul>
	<li>
          <p>
            <xref ref="thm_Green" text="title"/> tells us that we can
            calculate the circulation of a smooth vector field along a
            simple closed curve that bounds a region in the plane on
            which the vector field is also smooth by calculating the
            double integral of the circulation density instead of the
            line integral.
          </p>
	</li>

	<li>
          <p>
	  Integrating the circulation density of a smooth vector field
	  on a region bounded by a simple closed curve gives the same
	  value as calculating the circulation of the vector field
	  around the boundary of the region with suitable
	  orientation.</p>
	</li>

      </ul>
    </p>
  </subsection>
  <xi:include href="exercises/ez-S_Vector_Green.ptx"/>
  <subsection component="instructor">
	<title>Notes to Instructors and Dependencies</title>
	<p>
	  This section relies on the calculation of circulation around a closed curve from <xref ref="S_Vector_IdeaLineIntegral" /> and <xref ref="S_Vector_ParamLineIntegrals" /> as well as the idea of circulation density that was described in <xref ref="S_Vector_Div" />. 
	</p>
  </subsection>
</section>
