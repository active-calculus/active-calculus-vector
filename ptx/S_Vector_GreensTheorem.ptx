<section xml:id="S_Vector_GreensTheorem">
    <title>Green's Theorem</title>
    <objectives>
      <ul>
        <li>
          <p>
	    How can we calculate the circulation around a closed curve
	    in a vector field that is not path-independent?
          </p>
        </li>

        <li>
          <p>
	    There's more, right?
          </p>
        </li>

        <li>
          <p>
	    And probably another one?
          </p>
        </li>
      </ul>
    </objectives>
  <introduction>
    <p>
      We know from <xref ref="S_12_4_FTCLI" text="type-global" /> that
      a vector field is path-independent if and only if the
      ciruclation around every closed curve in its domain is
      <m>0</m>. It is probably not surprising that, given the
      multitude of names we have for path-independent vector fields,
      they are important vector fields that arise frequently. However,
      not every vector field is path-independent, and many times we
      will want to calculate the circulation around a closed curve in
      a vector field that is not path-independent. This section
      explores a connection between line integrals and double
      integrals that you may find surprising.
    </p>

    <exploration xml:id="PA_Vector_GreensTheorem">
        <introduction>
        <p>We will consider the vector field <m>\vF = \langle 2y,3x^2
	y\rangle</m>, which is defined on the entire plane. Suppose
	that we want to calculate the circulation of <m>\vF</m> around
	the circle <m>C</m> of radius <m>2</m>, centered at <m>(0,0)</m>, and
	oriented counterclockwise.
        </p>
        </introduction>
        <task xml:id="task_PA_Vector_GreensTheorem_Circ">
            <statement>
            <p>Verify that <m>\vF</m> is not path-independent by
	    calculating the circulation of <m>\vF</m> around the
	    circle <m>C</m>. The SageMath cell below is set up to
	    assist you with this, but you will need to supply a
	    parameterization of <m>C</m> on line 3.
            </p>
	    <sage>
	      <input>
var('r,t,x,y')
F = vector([2*y,3*x^2*y])
C = vector([ , ])# Supply a parameterization of C here inside the [ ]
integral(F(x=C[0],y=C[1]).dot_product(derivative(C,t)),t,0,2*pi)
	      </input>
	    </sage>
            </statement>
            <answer>
	      <p><m>-8\pi</m></p>
            </answer>
            <solution>
	      <p>If we parameterize <m>C</m> as <m>\vr(t) = \langle
	      2\cos(t),2\sin(t)\rangle</m>, then <m>\oint_C \vF\cdot
	      d\vr = -8\pi</m>. To use the SageMath cell to do this,
	      make line 3 read <c>C = vector([2*cos(t),2*sin(t)])</c>
	      and execute. Because the circulation around <m>C</m> is
	      not <m>0</m>, we know that <m>\vF</m> is not
	      path-independent. 
	      </p>
            </solution>
        </task>
        <task xml:id="task_PA_Vector_GreensTheorem_Integrand">
            <statement>
                <p>
		  Consider <m>\vF = \langle
		F_1(x,y),F_2(x,y)\rangle</m>. Without doing any
		calculations, do you think that
		<m>\displaystyle \frac{\partial F_2}{\partial x} -
		\frac{\partial F_1}{\partial y}</m> is <m>0</m> for
		all values of <m>x</m> and <m>y</m>?  Calculate <m>\displaystyle \frac{\partial F_2}{\partial x} -
		\frac{\partial F_1}{\partial y}</m> to confirm your answer.
		</p>
            </statement>
            <answer>
	      <p>No; <m>6xy-2</m>.</p>
            </answer>
            <solution>
	      	      <p>Since <m>\vF</m> is not path independent, we
		      know that <m>\vF</m> is not a gradient vector
		      field. Thus, we would not expect <m>\displaystyle \frac{\partial F_2}{\partial x} -
		\frac{\partial F_1}{\partial y}</m> to be <m>0</m> for
		all values of <m>x</m> and <m>y</m> as would be the
		case if <m>\vF</m> were the gradient of a smooth function. Here we have that <m>\partial F_2/\partial x
		      =6xy</m> and <m>\partial F_1/\partial y = 2</m>,
		      so we have that <m>\partial F_2/\partial x
		      - \partial F_1/\partial y= 6xy-2</m>.
		      </p>
            </solution>
        </task>
        <task xml:id="task_PA_Vector_GreensTheorem_Double">
          <statement>
	    <p>
	    In <alert>OK, put something here about what comes in
		the curl section</alert>. Calculate the double
		integral of <m>\displaystyle \frac{\partial F_2}{\partial x} -
		\frac{\partial F_1}{\partial y}</m> over the region
		inside the circle <m>C</m>. This integral is not the
		most fun to do by hand, so a SageMath cell has been
		provided to assist you. 
            </p>
	  <sage>
	    <input>
integral(integral( FUNCTION HERE , var1, start, stop), var2, start, stop)	      
	    </input>
	  </sage>
	  </statement>
	  <hint>
	    <p>If you choose polar coordinates, use <m>\theta</m> for the
	    first variable and <m>r</m> for the second variable.</p>
	  </hint>
	<answer>
	  <p><m>-8\pi</m></p>
	</answer>
	<solution>
	  <p>
	    Denote by <m>D</m> the region inside the circle <m>C</m>. We can describe <m>D</m> readily in polar coordinates
	    with the inequalities <m>0\leq r \leq 2</m> and <m>0\leq
	    \theta\leq 2\pi</m>. Thus, we need to calculate
	    <md>
	      <mrow>\iint_D \left(\frac{\partial F_2}{\partial x} -
		\frac{\partial F_1}{\partial y}\right)\, dA &amp;= \iint_D
	      (6xy-2)\, dA</mrow>
	      <mrow>&amp;= \int_0^2 \int_0^{2\pi}
	      (6r^2\cos(\theta)\sin(\theta) - 2)r\, d\theta\, dr</mrow>
	    </md>.
	    Using SageMath to calculate this, we obtain <m>-8\pi</m>.
	  </p>
	</solution>
	</task>
	<conclusion>
	  <p>A natural question after completing this Preview Activity
	  is if there is something special about the vector field
	  <m>\vF</m> or the curve <m>C</m> that led to the results you
	  obtained, and investigating this will be our principal task
	  in this section</p>
	</conclusion>
      </exploration>
  </introduction>

  <subsection>
    <title>Circulation</title>
    <p>
      This is where there will be a cartoon with a bunch of tiny
      circulations and the idea of cancelling circulations when we
      break up a region into boxes. I'm too lazy to draw the figures
      right now.
    </p>
    <activity>
      <p>
	Do Green's Theorem for rectangles, but try to build it out of
	NL's work on 2D curl so that they can just grab earlier work.
      </p>
    </activity>
  </subsection>

  <subsection>
    <title>Green's Theorem</title>
    <theorem xml:id="thm_Green">
      <title>
	Green's Theorem
      </title>
      <statement>
	<p>Let <m>C</m> be a simple, closed curve in the plane that
	bounds a region <m>R</m> with <m>C</m> oriented in such a
	way that when walking along <m>C</m> in the direction of its
	orientation, the region <m>R</m> is on our left. Suppose that
	<m>\vF=\langle F_1,F_2\rangle</m> is vector field with continuous partial derivatives
	on the region <m>R</m> and its boundary <m>C</m>. The
	circulation of <m>\vF</m> along <m>C</m> may be calculated as
	<me>\oint_C \vF\cdot d\vr = \iint_R \left(\frac{\partial F_2}{\partial x} -
		\frac{\partial F_1}{\partial y}\right)\, dA</me>.</p>
      </statement>
    </theorem>

    <p>
      At first glance, it may seem that <xref ref="thm_Green"
      text="title" /> is of purely intellectual interest. However, we
      have already encountered a number of instances where
      parameterizing a curve can be complicated. This is particularly
      true when the curve has <q>corners</q> that require us to give
      separate parameterizations for several pieces of the
      curve. However, it is often the case that a curve that is
      difficult to parameterize bounds a region that is not too
      complex to describe using rectangular or polar coordinates. For
      instance, if <m>C</m> is the square with vertices <m>(0,0)</m>,
      <m>(2,0)</m>, <m>(2,2)</m>, and <m>(0,2)</m>, a reasonable
      parameterization involves four line segments. However, the
      region insice <m>C</m> can be described using the inequalities
      <m>0\leq x\leq 2</m> and <m>0\leq y\leq 2</m>. Additionally, the
      integrand of the double integral in <xref ref="thm_Green"
      text="title" /> involves partial derivatives that can sometimes
      result in an integrand that is very easy to work with. The next
      activity asks you to apply <xref ref="thm_Green"
      text="title" /> in a few instances.
    </p>
  </subsection>

  <subsection>
    <title>Plotting Vector Fields</title>
    <p>
      <xref ref="PA_12_1">Preview Activity</xref>
      gave you a chance to plot some vectors
      in the vector fields <m>\vF(x,y) = \langle y,x\rangle</m> and <m>\vG(x,y) =
      \langle 0,-x\rangle</m>.
      It would be impossible to sketch <em>all</em> of
      the vectors in these vector fields,
      since there is one for every point
      in the plane.
      In fact, even sketching by hand many more of the vectors
      than you were asked to in the preview activity rapidly becomes
      tedious.
      Fortunately, computer algebra systems can do a great job of
      making such sketches.
      One thing to keep in mind, however, is that the
      magnitudes of the vectors are typically scaled in these plots,
      including plots of vector fields we will encounter later in the
      text.
      To illustrate this, consider the two plots of the vector field
      <m>\vF(x,y) = y\vi + x\vj</m> in <xref ref="fig_12_1_scale-field">Figure</xref>.
    </p>

    <figure xml:id="fig_12_1_scale-field">
      <caption>Two plots of <m>\vF(x,y) = y\vi + x\vj</m> from a computer
      algebra system</caption>
      <sidebyside widths="47% 47%" margins="0% 6% 0%">
          <image source="images/12_1_vecfield_unscaled" />
          <image source="images/fig_12_1_vecfield_scaled" />
      </sidebyside>
    </figure>

    <p>
      The left plot shows some of the vectors but accurately depicts all of
      their magnitudes, making the figure very hard to understand,
      especially along the lines <m>y=x</m> and <m>y=-x</m>.
      The plot on the right,
      however, uses a uniform scaling to make the figure easier to read.
      As
      before, each vector's direction is completely accurate,
      but now the
      magnitudes are much smaller.
      However, the <em>relative</em> magnitudes
      are preserved,
      helping us to see that vectors farther from the origin
      have larger magnitude than those closer to the origin.
    </p>

    <activity xml:id="A_12_1_1">
        <introduction>
            <p>
        The plot in <xref ref="fig_12_1_circle">Figure</xref> illustrates the vector
        field <m>\vF(x,y) = y\vi -x\vj</m>.
      </p>

      <figure xml:id="fig_12_1_circle">
        <caption>The vector field <m>y\vi-x\vj</m></caption>
        <image width="50%" source="images/fig_12_1_circle" />
      </figure>
        </introduction>
        <task>
          <p>
            Starting with one of the vectors near the point <m>(2,0)</m>, sketch
            a curve that follows the direction of the vector field <m>\vF</m>.
            To
            help visualize what you are doing,
            it may be useful to think of the
            vector field as the velocity vector field for some flowing water and
            that you are imagining tracing the path that a tiny particle
            inserted into the water would follow as the water moved it around.
          </p>
        </task>
        <task>
          <p>
            Repeat the previous step for at least two other starting points
            not on the curve you previously sketched.
          </p>
        </task>
        <task>
          <p>
            What shape do the curves you sketched in the previous two steps
            form?
          </p>
        </task>
        <task>
          <p>
            Verify that <m>\vF(x,y)</m> is orthogonal to <m>\langle x,y\rangle</m>.
          </p>
        </task>
        <task>
          <p>
            What is the relationship between the function
            <m>f(x,y) = x^2 +
            y^2</m> and the vector <m>x\vi + y\vj</m>?
          </p>
        </task>
        <task>
          <p>
            What does this tell you about the relationship between
            <m>\vF(x,y)</m> and circles centered at the origin?
            What is the
            relationship between <m>|\vF(x,y)|</m> and the radius of the appropriate circle?
          </p>
        </task>
    </activity>
  </subsection>

  <subsection>
    <title>Gradient Vector Fields</title>
    <p>
      Without using the terminology,
      we've actually already encountered one
      very important family of vector fields a number of times.
      Given a function <m>f</m> of two or three variables, the gradient of
      <m>f</m> is a vector field, since for any point where <m>f</m> has first-order
      partial derivatives, <m>\nabla f</m> assigns a vector to that point.
    </p>

    <activity xml:id="A_12_1_2">
        <task>
            <p>
            In <xref ref="fig_12_1_level-curves">Figure</xref>
            there are three sets of axes showing level
            curves for functions <m>f</m>,
            <m>g</m>, and <m>h</m>, respectively.
            Sketch at least six vectors
            in the gradient vector field for each function.
            In making your
            sketches, you don't have to worry about getting vector magnitudes
            precise, but you should ensure that the relative magnitudes
            (and directions)
            are
            correct for each function independently.
            </p>
            <figure xml:id="fig_12_1_level-curves">
                <caption>Three sets of level curves</caption>
                <sidebyside widths="30% 30% 30%" margins="0% 5% 5% 0%">
                    <figure>
                        <caption><m>f</m></caption>
                        <image source="images/12_1_ellipses" />
                    </figure>
                    <figure>
                        <caption><m>g</m></caption>
                        <image source="images/12_1_linear" />
                    </figure>
                    <figure>
                        <caption><m>h</m></caption>
                        <image source="images/12_1_sine" />
                    </figure>
                </sidebyside>
            </figure>
        </task>
        <task xml:id="part_A12_2-pot">
          <p>
            Verify that <m>\vF(x,y) = \langle 6xy,3x^2+9\sqrt{y}\rangle</m> is a
            gradient vector field by finding a function <m>f</m> such that <m>\nabla
            f(x,y) = \vF(x,y)</m>.
            For reasons originating in physics, such a
            function <m>f</m> is called a <em>potential function</em> for the vector
            field <m>\vF</m>.
          </p>
        </task>
        <task>
          <p>
            Is the function <m>f</m> found in <xref ref="part_A12_2-pot">part</xref> unique?
            That is, can you find another function <m>g</m> such that <m>\nabla g(x,y)
            = \vF(x,y)</m> but <m>f\neq g</m>?
          </p>
        </task>
        <task>
          <p>
            Is the vector field <m>\vF(x,y) = 6xy\vi +(2x+9\sqrt{y})\vj</m> a
            gradient vector field?
            Why or why not?
          </p>
        </task>
    </activity>
  </subsection>

  <subsection>
      <title>Summary</title>
      <p>
    <ul>
      <li>
        <p>
          A <m>2</m>-dimensional vector field is a function defined on part of
          <m>\R^2</m> whose value is a <m>2</m>-dimensional vector.
          A <m>3</m>-dimensional
          vector field is a function defined on part of <m>\R^3</m> whose value is
          a <m>3</m>-dimensional vector.
        </p>
      </li>

      <li>
        <p>
          Vector fields arise in familiar contexts such as wind velocity,
          fluid velocity, and gravitational force.
        </p>
      </li>

      <li>
        <p>
          Vector fields are generally plotted in ways that ensure the
          direction and relative magnitudes of the vectors sketched are
          correct instead of ensuring that each vector's magnitude is
          depicted correctly.
        </p>
      </li>

      <li>
        <p>
          The gradient of a function <m>f</m> of two or three variables is a vector
          field defined wherever <m>f</m> has partial derivatives.
        </p>
      </li>
    </ul>
  </p>
  </subsection>
<exercises>
    <exercise>
        <statement>
            <p>Here is the statement.</p>
        </statement>
        <hint><p>A hint! Don't feel obligated to use hints, but they are an option.</p></hint>
        <answer>
            <p>
                The answer. Keep this simple as will be made public <q>back of the book</q>-style. <alert>Do not put anything with a number/or <attr>xml:id</attr> on it in an <tag>answer</tag> or <tag>solution</tag>, because this will mess up the numbering of subsequent things in the book. Techincally <attr>xml:id</attr> is fine, but note that the reference might not be useful in the end. Definitely don't use <tag>figure</tag> or <tag>table</tag> in one of these things; wrap <tag>tabular</tag> and <tag>image</tag> in <tag>sidebyside</tag>.</alert>
            </p>
        </answer>
        <solution>
            <p>
                The full solution. Full details go here.
            </p>
        </solution>
    </exercise>
</exercises>
</section>

